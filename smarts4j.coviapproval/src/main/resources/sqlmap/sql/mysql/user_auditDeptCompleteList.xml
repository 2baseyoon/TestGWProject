<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user.AuditDeptCompleteList">
    <!-- 감사문서함 진행 리스트 조회 -->
	<select id="selectAuditDeptProcessList" parameterType="cmap" resultType="cmap">
		SELECT  AuditDeptProcessList.* FROM(
				SELECT
				Subject AS FormSubject
				, FI.FormID
				, FI.FormInstID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, FI.InitiatedDate
				, FI.CompletedDate
				, FI.EntCode
				, P.ProcessState
				, PD.ProcessDescriptionID AS ProcessDescriptionArchiveID
				, PD.DocNo
				, PD.FormName
				, PD.FormPrefix
				, PD.BusinessData1
				, PD.BusinessData2
				, PD.IsSecureDoc
				, PD.IsFile
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptProcessList
		<!-- 검색 데이터 Where 절 -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				InitiatedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="deptID == ''">
		  	   1=0
		  	</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
		            <when test="searchGroupType == 'Date' ">
						AND InitiatedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
		            </when>
		            <otherwise>
		                AND
		                <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
		           		</choose>
		           		 = #{searchGroupWord}
		            </otherwise>
		        </choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, InitiatedDate DESC
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	,
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatedDate")'>InitiatedDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
			LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
		 -->
		<if test="pageSize != null and pageOffset != null">
			LIMIT #{pageSize} OFFSET #{pageOffset}
		</if>
	</select>

	<!-- 감사문서함 리스트 진행 카운트 조회 -->
	<select id="selectAuditDeptProcessListCnt" resultType="java.lang.Long">
		SELECT  COUNT(*) FROM(
				SELECT
				Subject AS FormSubject
				, FI.FormID
				, FI.FormInstID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, FI.InitiatedDate
				, FI.CompletedDate
				, FI.EntCode
				, P.ProcessState
				, PD.ProcessDescriptionID AS ProcessDescriptionArchiveID
				, PD.DocNo
				, PD.FormName
				, PD.FormPrefix
				, PD.BusinessData1
				, PD.BusinessData2
				, PD.IsSecureDoc
				, PD.IsFile
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptProcessList
		<!-- 검색 데이터 Where 절 -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				InitiatedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="deptID == ''">
		  	   1=0
		  	</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
		            <when test="searchGroupType == 'Date' ">
						AND InitiatedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
		            </when>
		            <otherwise>
		                AND
		                <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
		           		</choose>
		           		 = #{searchGroupWord}
		            </otherwise>
		        </choose>
			</if>
		</trim>
	</select>
	
	<!-- 감사문서함 완료 리스트 조회 -->
	<select id="selectAuditDeptCompleteList" parameterType="cmap" resultType="cmap">
		SELECT  AuditDeptCompleteList.* FROM(
				SELECT
				Subject AS FormSubject
				, FI.FormID
				, FI.FormInstID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, FI.InitiatedDate
				, FI.CompletedDate
				, FI.EntCode
				, P.ProcessState
				, PD.ProcessDescriptionID AS ProcessDescriptionArchiveID
				, PD.DocNo
				, PD.FormName
				, PD.FormPrefix
				, PD.BusinessData1
				, PD.BusinessData2
				, PD.IsSecureDoc
				, PD.IsFile
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 528
				AND BusinessState LIKE '02_01%'
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptCompleteList
		<!-- 검색 데이터 Where 절 -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				CompletedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="deptID == ''">
		  	   1=0
		  	</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
		            <when test="searchGroupType == 'Date' ">
						AND CompletedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
		            </when>
		            <otherwise>
		                AND
		                <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
		           		</choose>
		           		 = #{searchGroupWord}
		            </otherwise>
		        </choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, CompletedDate DESC
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	,
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("CompletedDate")'>CompletedDate</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
			LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
		 -->
		<if test="pageSize != null and pageOffset != null">
			LIMIT #{pageSize} OFFSET #{pageOffset}
		</if>
	</select>

	<!-- 감사문서함 완료 리스트 카운트 조회 -->
	<select id="selectAuditDeptCompleteListCnt" resultType="java.lang.Long">
		SELECT  COUNT(*) FROM(
				SELECT
				Subject AS FormSubject
				, FI.FormID
				, FI.FormInstID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, FI.InitiatedDate
				, FI.CompletedDate
				, FI.EntCode
				, P.ProcessState
				, PD.ProcessDescriptionID AS ProcessDescriptionArchiveID
				, PD.DocNo
				, PD.FormName
				, PD.FormPrefix
				, PD.BusinessData1
				, PD.BusinessData2
				, PD.IsSecureDoc
				, PD.IsFile
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 528
				AND BusinessState LIKE '02_01%'
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptCompleteList
		<!-- 검색 데이터 Where 절 -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				CompletedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="deptID == ''">
		  	   1=0
		  	</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
		            <when test="searchGroupType == 'Date' ">
						AND CompletedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
		            </when>
		            <otherwise>
		                AND
		                <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
		           		</choose>
		           		 = #{searchGroupWord}
		            </otherwise>
		        </choose>
			</if>
		</trim>
	</select>
	
	<!-- 감사문서함  그룹별 진행 목록 조회 -->
	<select id="selectAuditDeptProcessGroupList" parameterType="cmap" resultType="cmap">
		SELECT
		<if test='searchGroupType.equalsIgnoreCase("Date")'>
			Date AS fieldID
			, COUNT(Date) AS fieldCnt
			, Date as fieldName
		</if>
		<if test='searchGroupType.equalsIgnoreCase("FormPrefix")'>
			FormPrefix AS fieldID
			, COUNT(FormPrefix) AS fieldCnt
			, FormName as fieldName
		</if>
		<if test="searchGroupType == 'InitiatorID'">
			InitiatorID AS fieldID
			, COUNT(InitiatorID) AS fieldCnt
			, InitiatorName as fieldName
		</if>
		<if test="searchGroupType == 'InitiatorUnitID'">
			InitiatorUnitID AS fieldID
			, COUNT(InitiatorUnitID) AS fieldCnt
			, InitiatorUnitName as fieldName
		</if>
		FROM (
				SELECT Subject AS FormSubject
				, FI.FormID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, PD.FormName
				, PD.FormPrefix
				<choose>
					<when test="searchGroupType == 'Date'">
						, CASE WHEN IFNULL(FI.InitiatedDate, '') = '0000-00-00 00:00:00' THEN ''
						ELSE DATE_FORMAT(covi_smart4j.Fn_NewComURTimeZoneTrans_S(#{UR_TimeZone}, FI.InitiatedDate),'%Y-%m-%d')
						END AS 'Date'
					</when>
					<otherwise>
						, DATE_FORMAT(FI.InitiatedDate,'%Y-%m-%d') AS 'Date'
					</otherwise>
				</choose>
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
						<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
							OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
						</if>
					)
				</if>
			) AS AuditDeptProcessList
		<!-- 검색 Where 절  -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				Date BETWEEN TO_CHAR(TO_DATE(#{startDate}, 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD') AND TO_CHAR(TO_DATE(#{endDate}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD')
			</if>
			<if test="deptID == ''">
				1=0
			</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
			<if test="searchGroupType != null and searchGroupType != '' ">
				<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID, InitiatorName</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID, InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix, FormName</when>
				</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
			<if test="searchGroupType != null ">
				fieldName ASC
			</if>
		</trim>
	</select>
	
	<!-- 감사문서함  그룹별 완료 목록 조회 -->
	<select id="selectAuditDeptCompleteGroupList" parameterType="cmap" resultType="cmap">
		SELECT
		<if test='searchGroupType.equalsIgnoreCase("Date")'>
			Date AS fieldID
			, COUNT(Date) AS fieldCnt
			, Date as fieldName
		</if>
		<if test='searchGroupType.equalsIgnoreCase("FormPrefix")'>
			FormPrefix AS fieldID
			, COUNT(FormPrefix) AS fieldCnt
			, FormName as fieldName
		</if>
		<if test="searchGroupType == 'InitiatorID'">
			InitiatorID AS fieldID
			, COUNT(InitiatorID) AS fieldCnt
			, InitiatorName as fieldName
		</if>
		<if test="searchGroupType == 'InitiatorUnitID'">
			InitiatorUnitID AS fieldID
			, COUNT(InitiatorUnitID) AS fieldCnt
			, InitiatorUnitName as fieldName
		</if>
		FROM (
				SELECT Subject AS FormSubject
				, FI.FormID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, PD.FormName
				, PD.FormPrefix
				<choose>
					<when test="searchGroupType == 'Date'">
						, CASE WHEN IFNULL(FI.CompletedDate, '') = '0000-00-00 00:00:00' THEN ''
						ELSE DATE_FORMAT(covi_smart4j.Fn_NewComURTimeZoneTrans_S(#{UR_TimeZone}, FI.CompletedDate),'%Y-%m-%d')
						END AS 'Date'
					</when>
					<otherwise>
						, DATE_FORMAT(FI.CompletedDate,'%Y-%m-%d') AS 'Date'
					</otherwise>
				</choose>
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 528
				AND BusinessState LIKE '02_01%'
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
						<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
							OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
						</if>
					)
				</if>
			) AS AuditDeptCompleteList
		<!-- 검색 Where 절  -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				Date BETWEEN TO_CHAR(TO_DATE(#{startDate}, 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD') AND TO_CHAR(TO_DATE(#{endDate}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD')
			</if>
			<if test="deptID == ''">
				1=0
			</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
			<if test="searchGroupType != null and searchGroupType != '' ">
				<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID, InitiatorName</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID, InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix, FormName</when>
				</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
			<if test="searchGroupType != null ">
				fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 감사문서함 엑셀 진행 데이터 조회 -->
	<select id="selectAuditDeptProcessListExcel" parameterType="cmap" resultType="cmap">
		SELECT  AuditDeptProcessList.* FROM(
				SELECT
				Subject AS FormSubject
				, FI.FormID
				, FI.FormInstID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, DATE_FORMAT(FI.InitiatedDate,'%Y-%m-%d %H:%i:%s') AS InitiatedDate
				, FI.EntCode
				, P.ProcessState
				, PD.ProcessDescriptionID AS ProcessDescriptionArchiveID
				, PD.FormName
				, PD.FormPrefix
				, PD.BusinessData1
				, PD.BusinessData2
				, PD.IsSecureDoc
				, PD.IsFile
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptProcessList
		<!-- 검색 데이터 Where 절 -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				AND InitiatedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="deptID == ''">
		  	   1=0
		  	</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
		            <when test="searchGroupType == 'Date' ">
						AND InitiatedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
		            </when>
		            <otherwise>
		                AND
		                <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
		           		</choose>
		           		 = #{searchGroupWord}
		            </otherwise>
		        </choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, InitiatedDate DESC
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	,
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatedDate")'>InitiatedDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
	
	<!-- 감사문서함 엑셀 완료 데이터 조회 -->
	<select id="selectAuditDeptCompleteListExcel" parameterType="cmap" resultType="cmap">
		SELECT  AuditDeptCompleteList.* FROM(
				SELECT
				Subject AS FormSubject
				, FI.FormID
				, FI.FormInstID
				, FI.ProcessID AS ProcessArchiveID
				, FI.InitiatorUnitID
				, FI.InitiatorUnitName
				, FI.InitiatorID
				, FI.InitiatorName
				, DATE_FORMAT(FI.CompletedDate,'%Y-%m-%d %H:%i:%s') AS CompletedDate
				, FI.EntCode
				, P.ProcessState
				, PD.ProcessDescriptionID AS ProcessDescriptionArchiveID
				, PD.DocNo
				, PD.FormName
				, PD.FormPrefix
				, PD.BusinessData1
				, PD.BusinessData2
				, PD.IsSecureDoc
				, PD.IsFile
				FROM covi_approval4j.jwf_process AS P
				INNER JOIN covi_approval4j.jwf_processdescription AS PD ON PD.ProcessDescriptionID = P.ProcessDescriptionID
				INNER JOIN covi_approval4j.jwf_forminstance AS FI ON P.ProcessID = FI.ProcessID
				INNER JOIN covi_smart4j.sys_object_group AS G ON FI.InitiatorUnitID = G.GroupCode
				WHERE ProcessState = 528
				AND BusinessState LIKE '02_01%'
				<if test="adminYn == null or adminYn == '' ">
					AND P.DeleteDate IS NULL
				</if>
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( FI.InitiatorUnitID = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR G.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptCompleteList
		<!-- 검색 데이터 Where 절 -->
		<trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
				CompletedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="deptID == ''">
		  	   1=0
		  	</if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
		            <when test="searchGroupType == 'Date' ">
						AND CompletedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
		            </when>
		            <otherwise>
		                AND
		                <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
		           		</choose>
		           		 = #{searchGroupWord}
		            </otherwise>
		        </choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, CompletedDate DESC
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	,
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("CompletedDate")'>CompletedDate</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
	
    <!-- 감사문서함 리스트 조회 -->
	<select id="selectStoreAuditDeptCompleteList" parameterType="cmap" resultType="cmap">
	     SELECT  AuditDeptCompleteList.* FROM(
				SELECT A.ProcessArchiveID
				, A.DocSubject
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, A.InitiatorID
				, A.InitiatorName
				, A.FormPrefix
				, C.*
				, A.EndDate
				,'' as SubKind
				FROM covi_approval4j_store.jwf_processarchive AS A
				INNER JOIN covi_smart4j.sys_object_group AS B ON A.InitiatorUnitID = B.GroupCode
				INNER JOIN covi_approval4j_store.jwf_processdescriptionarchive AS C ON A.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				WHERE A.DeleteDate IS NULL
				AND (A.BusinessState LIKE '02_01%' OR A.BusinessState = '03_01_01')
				AND A.ParentProcessID = 0
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( B.GroupCode = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR B.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptCompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND|OR">
		  	 <if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	 <if test="deptID == ''">
		  	    1=0
		  	 </if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>DocSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate LIKE CONCAT('%',#{searchGroupWord},'%')
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>AuditDeptCompleteList.InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>AuditDeptCompleteList.InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>AuditDeptCompleteList.FormPrefix</when>
		           		</choose>
		           		 = #{searchGroupWord}
	                </otherwise>
	            </choose>		
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
				</choose>	 
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

	<!-- 감사문서함 리스트 카운트 조회 -->
	<select id="selectStoreAuditDeptCompleteListCnt" resultType="java.lang.Long">
	     SELECT COUNT(*) FROM (
				SELECT A.ProcessArchiveID
				, A.DocSubject
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, A.InitiatorID
				, A.InitiatorName
				, A.FormPrefix
				, C.*
				, A.EndDate
				,'' as SubKind
				FROM covi_approval4j_store.jwf_processarchive AS A
				INNER JOIN covi_smart4j.sys_object_group AS B ON A.InitiatorUnitID = B.GroupCode
				INNER JOIN covi_approval4j_store.jwf_processdescriptionarchive AS C ON A.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				WHERE A.DeleteDate IS NULL
				AND (A.BusinessState LIKE '02_01%' OR A.BusinessState = '03_01_01')
				AND A.ParentProcessID = 0
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( B.GroupCode = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR B.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptCompleteList
	    <trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	 <if test="deptID == ''">
		  	    1=0
		  	 </if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>DocSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate LIKE CONCAT('%',#{searchGroupWord},'%')
	                </when>
	                <otherwise>
	                    AND 
			            <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>AuditDeptCompleteList.InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>AuditDeptCompleteList.InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>AuditDeptCompleteList.FormPrefix</when>
		           		</choose>
	                    = #{searchGroupWord}
	                </otherwise>
	            </choose>	
			</if>
		</trim>
	</select>

	<!-- 감사문서함  그룹별 목록 조회 -->
	<select id="selectStoreAuditDeptCompleteGroupList" parameterType="cmap" resultType="cmap">
		SELECT
		<if test='searchGroupType.equalsIgnoreCase("Date")'>
			AuditDeptCompleteList.`Date` AS fieldID
			, COUNT(AuditDeptCompleteList.`Date`) AS fieldCnt
	        , AuditDeptCompleteList.`Date` as fieldName
	    </if>
	    <if test='searchGroupType.equalsIgnoreCase("FormPrefix")'>
			AuditDeptCompleteList.`FormPrefix` AS fieldID
			, COUNT(AuditDeptCompleteList.`FormPrefix`) AS fieldCnt
	        , AuditDeptCompleteList.FormName as fieldName
	    </if>
     	<if test="searchGroupType == 'InitiatorID'">
			AuditDeptCompleteList.`InitiatorID` AS fieldID
			, COUNT(AuditDeptCompleteList.`InitiatorID`) AS fieldCnt
	        , AuditDeptCompleteList.InitiatorName as fieldName
	    </if>
     	<if test="searchGroupType == 'InitiatorUnitID'">
			AuditDeptCompleteList.`InitiatorUnitID` AS fieldID
			, COUNT(AuditDeptCompleteList.`InitiatorUnitID`) AS fieldCnt
	        , AuditDeptCompleteList.InitiatorUnitName as fieldName
	    </if>
			FROM (
				SELECT A.ProcessArchiveID
				, A.DocSubject
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, A.InitiatorID
				, A.InitiatorName
				, A.FormName
				, C.FormID
				, A.FormPrefix
				<choose>
					<when test="searchGroupType == 'Date'">
						,CASE WHEN IFNULL(A.EndDate, '') = '0000-00-00 00:00:00' THEN '' 
						ELSE DATE_FORMAT(covi_smart4j.Fn_NewComURTimeZoneTrans_S(#{UR_TimeZone}, A.EndDate),'%Y-%m-%d')
						END AS 'Date'					
					</when>
					<otherwise>
						, DATE_FORMAT(A.EndDate,'%Y-%m-%d') AS `Date`
					</otherwise>
				</choose>
				FROM covi_approval4j_store.jwf_processarchive AS A
				INNER JOIN covi_smart4j.sys_object_group AS B ON A.InitiatorUnitID = B.GroupCode
				INNER JOIN covi_approval4j_store.jwf_processdescriptionarchive AS C ON A.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				WHERE A.DeleteDate IS NULL
				AND (A.BusinessState LIKE '02_01%' OR A.BusinessState = '03_01_01')
				AND A.ParentProcessID = 0
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( B.GroupCode = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR B.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptCompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	 <if test="deptID == ''">
		  	    1=0
		  	 </if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
		       AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>DocSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>AuditDeptCompleteList.InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>AuditDeptCompleteList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>AuditDeptCompleteList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>AuditDeptCompleteList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>AuditDeptCompleteList.FormPrefix</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 감사문서함 엑셀 데이터 조회 -->
	<select id="selectStoreAuditDeptCompleteListExcel" parameterType="cmap" resultType="cmap">
			SELECT AuditDeptCompleteList.* FROM (
				SELECT A.ProcessArchiveID
				, A.DocSubject
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, A.InitiatorID
				, A.InitiatorName
				,'' as SubKind
				, C.*
				, DATE_FORMAT(A.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
				FROM covi_approval4j_store.jwf_processarchive AS A
				INNER JOIN covi_smart4j.sys_object_group AS B ON A.InitiatorUnitID = B.GroupCode
				INNER JOIN covi_approval4j_store.jwf_processdescriptionarchive AS C ON A.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				WHERE A.DeleteDate IS NULL
				AND (A.BusinessState LIKE '02_01%' OR A.BusinessState = '03_01_01')
				AND A.ParentProcessID = 0
				<if test="deptID != ''"> 	<!-- deptID not null 경우 -->
					AND ( B.GroupCode = #{deptID}
					<if test="isCheckSubDept == 1"> 	<!-- 하위부서 포함 여부가 체크된  경우 -->
						OR B.GroupPath  LIKE CONCAT('%;',#{deptID},';%')
					</if>
					)
				</if>
			) AS AuditDeptCompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND|OR">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	 <if test="deptID == ''">
		  	    1=0
		  	 </if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND
			    <choose>
			        <when test='searchType.equalsIgnoreCase("FormSubject")'>DocSubject</when>
			        <when test='searchType.equalsIgnoreCase("InitiatorName")'>AuditDeptCompleteList.InitiatorName</when>	        
			        <when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
			    </choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			   	<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate LIKE CONCAT('%',#{searchGroupWord},'%')
	                </when>
	                <otherwise>
	                    AND 
						<choose>
							<when test='searchGroupType.equalsIgnoreCase("Date")'>Date</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
		           		</choose>
						 = #{searchGroupWord}
	                </otherwise>
	            </choose>	
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		   <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
				</choose>	 
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
</mapper>

